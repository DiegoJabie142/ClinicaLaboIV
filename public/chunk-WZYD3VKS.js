import{a as te}from"./chunk-WDKB7LLX.js";import{b as j}from"./chunk-4VZ6PA6B.js";import"./chunk-FK6H3RFT.js";import{a as re}from"./chunk-4QML42IX.js";import"./chunk-JUZHZSBE.js";import{h as ee}from"./chunk-5PP5VR5I.js";import"./chunk-7YVO6NQX.js";import{L as q,Q}from"./chunk-YYGECID7.js";import{Eb as c,Fb as T,Gb as $,Hb as G,Ib as J,Na as N,Nb as X,Pa as s,Qa as L,Wa as B,ba as U,db as v,ea as V,fa as R,fb as p,ha as W,kb as l,kc as K,lb as a,lc as Z,mb as D,oa as A,pa as F,pb as I,qa as M,sb as w,ub as b,va as Y}from"./chunk-HTI5VKZI.js";import{e as ae,g as O}from"./chunk-5G567QLT.js";var y=ae(re());var ie=(()=>{let r=class r{constructor(e,i){this.el=e,this.renderer=i,this.modoOscuro=!1}ngOnChanges(){this.actualizarTema()}actualizarTema(){this.modoOscuro?this.renderer.setStyle(this.el.nativeElement,"background-color","#212121"):this.renderer.setStyle(this.el.nativeElement,"background-color","#4c7bb8")}};r.\u0275fac=function(i){return new(i||r)(L(Y),L(B))},r.\u0275dir=W({type:r,selectors:[["","appToggleTheme",""]],inputs:{modoOscuro:[V.None,"appToggleTheme","modoOscuro"]},standalone:!0,features:[A]});let o=r;return o})();function le(o,r){if(o&1&&(l(0,"div",6),D(1,"img",7),a()),o&2){let t=b(2);s(),p("src",t.userData==null?null:t.userData.profilePic2,N)}}function ce(o,r){o&1&&(l(0,"strong"),c(1,"Obra Social: "),a())}function de(o,r){if(o&1&&(l(0,"p")(1,"strong"),c(2,"Especialidades:"),a(),c(3),a()),o&2){let t=b(2);s(3),$(" ",t.userData.specialities.join(", "),".")}}function pe(o,r){if(o&1){let t=I();l(0,"button",20),w("click",function(){let i=F(t).$implicit,n=b(3);return M(n.mostrarHistoriaClinica(i))}),c(1),a()}if(o&2){let t=r.$implicit;s(),J(" ",t.fecha," - ",t.horaInicio," - ",t.horaFin," ")}}function ge(o,r){if(o&1){let t=I();l(0,"div")(1,"button",18),w("click",function(){let i=F(t).$implicit,n=b(3);return M(n.descargarHistoriasClinicasPDFSegunEspecialidad(i.especialidad))}),c(2),a()()}if(o&2){let t=r.$implicit;s(2),$(" Descargar Historias Cl\xEDnicas (PDF) - ",t.especialidad," ")}}function me(o,r){if(o&1){let t=I();l(0,"div",15)(1,"h2"),c(2,"Historia Cl\xEDnica"),a(),l(3,"div",16),v(4,pe,2,3,"button",17),l(5,"button",18),w("click",function(){F(t);let i=b(2);return M(i.descargarHistoriasClinicasPDF())}),c(6," Descargar Historias Cl\xEDnicas (PDF) "),a(),v(7,ge,3,1,"div",19),a()()}if(o&2){let t=b(2);s(4),p("ngForOf",t.historiaClinica),s(3),p("ngForOf",t.historiasSegunEspecialidad)}}function fe(o,r){o&1&&(l(0,"div",21)(1,"h1"),c(2,"No tienes historia cl\xEDnica todav\xEDa."),a()())}function ue(o,r){o&1&&(l(0,"div",22),D(1,"app-mis-horarios"),a())}function he(o,r){if(o&1&&(l(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6),D(4,"img",7),a(),v(5,le,2,1,"div",8),a(),l(6,"div",9)(7,"h2",10),c(8),a(),l(9,"p")(10,"strong"),c(11,"Edad: "),a(),c(12),a(),l(13,"p")(14,"strong"),c(15,"DNI: "),a(),c(16),a(),l(17,"p")(18,"strong"),c(19,"Email: "),a(),c(20),a(),l(21,"p"),v(22,ce,2,0,"strong",11),c(23),a(),v(24,de,4,1,"p",11),a()(),v(25,me,8,2,"div",12)(26,fe,3,0,"div",13)(27,ue,2,0,"div",14),a()),o&2){let t=b();p("appToggleTheme",t.modoOscuro),s(4),p("src",t.userData==null?null:t.userData.profilePic,N),s(),p("ngIf",t.userData==null?null:t.userData.profilePic2),s(3),G("",t.userData==null?null:t.userData.name," ",t.userData==null?null:t.userData.lastName,""),s(4),T(t.userData==null?null:t.userData.age),s(4),T(t.userData==null?null:t.userData.dni),s(4),$(" ",t.userData==null?null:t.userData.email,""),s(2),p("ngIf",t.userData==null?null:t.userData.socialWork),s(),T(t.userData==null?null:t.userData.socialWork),s(),p("ngIf",t.userData==null?null:t.userData.specialities),s(),p("ngIf",t.historiaClinica.length>0),s(),p("ngIf",t.historiaClinica.length==0&&t.role=="paciente"),s(),p("ngIf",t.role=="especialista")}}var we=(()=>{let r=class r{constructor(){this.title="MyClinic",this.headerLinks=[],this.uid="",this.modoOscuro=!1,this.firebaseSvc=U(Q),this.utilSvc=U(q),this.isLoggedIn=!1,this.historiaClinica=[],this.historiasSegunEspecialidad=[],this.buttons=[],this.role=""}ngOnInit(){return O(this,null,function*(){this.isLoggedIn=yield this.estaLoggeado(),this.loadUserData(),this.role=this.getRoleFromLocalStorage(),this.getUidFromLocalStorage(),this.role=="paciente"&&this.cargarHistoriaClinica()})}cargarHistoriaClinica(){return O(this,null,function*(){let e=y.default.fire({title:"Cargando...",text:"Por favor espere, estamos cargando la historia cl\xEDnica...",showConfirmButton:!1,didOpen:()=>{y.default.showLoading()}});try{let i=yield this.firebaseSvc.getHistoriaClinica(this.uid);if(i&&i.length>0){let n=[];this.historiaClinica=i,i.forEach(g=>{let h=g.especialidad||"Especialidad no disponible",m=n.find(u=>u.especialidad===h);m||(m={especialidad:h,historias:[]},n.push(m)),m.historias.push(g)}),this.historiasSegunEspecialidad=n}else console.error("No se encontr\xF3 historia cl\xEDnica."),this.historiaClinica=[],this.historiasSegunEspecialidad=[]}catch(i){console.error("Error al obtener la historia cl\xEDnica:",i.message),this.historiaClinica=[],this.historiasSegunEspecialidad=[]}y.default.close()})}generateButtons(e){let i=[];for(let n in e)if(e.hasOwnProperty(n)){let g=e[n],[h,m,u,d,C]=n.split("_"),f=`${h}/${m}/${u}`,S=`${d}:00`,P=`${C}:00`,E=`${f} Inicio ${S} Fin ${P}`;i.push(E)}return i}getKeys(e){return Object.keys(e)}capitalizeFirstLetter(e){return e&&e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}getRoleFromLocalStorage(){try{let e=localStorage.getItem("user");return e&&JSON.parse(e).role||null}catch(e){return console.error("Error al obtener el rol del usuario desde localStorage:",e),null}}getUidFromLocalStorage(){let e=JSON.parse(localStorage.getItem("user")||"{}");e&&e.uid?this.uid=e.uid:console.error("UID no encontrado en localStorage")}estaLoggeado(){return O(this,null,function*(){return yield this.firebaseSvc.isUserLoggedIn()})}loadUserData(){return O(this,null,function*(){try{this.userData=yield this.firebaseSvc.getUserData()}catch(e){console.error("Error al cargar datos del usuario:",e)}})}getEspecialistaNombre(e){return this.firebaseSvc.getEspecialistaNombre(e)}mostrarHistoriaClinica(e){let i='<ul style="text-align: left;">';for(let[n,g]of Object.entries(e))typeof g!="object"&&(i+=`<li><strong>${this.formatearClave(n)}:</strong> ${g||"No disponible"}</li>`);i+="</ul>",y.default.fire({title:"Detalles de la Historia Cl\xEDnica",html:i,icon:"info",confirmButtonText:"Cerrar",width:"400px"})}formatearClave(e){return e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}descargarHistoriasClinicasPDFSegunEspecialidad(e){let i=this.historiasSegunEspecialidad.find(d=>d.especialidad===e);if(!i){console.error("No se encontraron historias cl\xEDnicas para esta especialidad.");return}let n=new j,g=new Date,h=`${g.getDate().toString().padStart(2,"0")}-${(g.getMonth()+1).toString().padStart(2,"0")}-${g.getFullYear()}`,m="assets/logo.png",u=new Image;u.src=m,u.onload=()=>{let d=document.createElement("canvas"),C=d.getContext("2d"),f=200;if(d.width=f,d.height=f,C){C.globalAlpha=.5,C.drawImage(u,0,0,f,f);let S=d.toDataURL("image/png"),P=n.internal.pageSize.getWidth(),E=n.internal.pageSize.getHeight(),x=(P-f)/2,k=(E-f)/2;n.addImage(S,"PNG",x,k,f,f),n.setFont("helvetica","bold"),n.setFontSize(20),n.text(`Historias Cl\xEDnicas - Especialidad: ${e}`,10,20),n.setFontSize(12),n.setFont("helvetica","normal"),n.text(`Fecha de emisi\xF3n: ${h}`,55,30);let _=40;i.historias.forEach((z,H)=>{n.setFontSize(14),n.setFont("helvetica","bold"),n.text(`Historia ${H+1}`,10,_),_+=8;for(let[ne,oe]of Object.entries(z))n.setFontSize(12),n.setFont("helvetica","normal"),n.text(`${this.formatearClave(ne)}: ${oe||"No disponible"}`,10,_),_+=6,_>270&&(n.addPage(),_=10);_+=8}),n.save(`Historias_Clinicas_${e}.pdf`)}else console.error("Error al obtener el contexto del canvas")}}descargarHistoriasClinicasPDF(){let e=new j,i=new Date,n=`${i.getDate().toString().padStart(2,"0")}-${(i.getMonth()+1).toString().padStart(2,"0")}-${i.getFullYear()}`,g="assets/logo.png",h=new Image;h.src=g,h.onload=()=>{let m=document.createElement("canvas"),u=m.getContext("2d"),d=200;if(m.width=d,m.height=d,u){u.globalAlpha=.5,u.drawImage(h,0,0,d,d);let C=m.toDataURL("image/png"),f=e.internal.pageSize.getWidth(),S=e.internal.pageSize.getHeight(),P=(f-d)/2,E=(S-d)/2;e.addImage(C,"PNG",P,E,d,d),e.setFont("helvetica","bold"),e.setFontSize(20),e.text("Informe de Historias Cl\xEDnicas",55,20),e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`Fecha de emisi\xF3n: ${n}`,55,30);let x=40;this.historiaClinica.forEach((k,_)=>{e.setFontSize(14),e.setFont("helvetica","bold"),e.text(`Historia ${_+1}`,10,x),x+=8;for(let[z,H]of Object.entries(k))e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`${this.formatearClave(z)}: ${H||"No disponible"}`,10,x),x+=6,x>280&&(e.addPage(),x=10);x+=8}),e.save("historias-clinicas.pdf")}else console.error("Error al obtener el contexto del canvas")}}cambiarTema(){this.modoOscuro=!this.modoOscuro}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=R({type:r,selectors:[["app-perfiles"]],standalone:!0,features:[X],decls:4,vars:2,consts:[[3,"title"],[1,"btn-flotante",3,"click"],["class","profile-section",3,"appToggleTheme",4,"ngIf"],[1,"profile-section",3,"appToggleTheme"],[1,"profile-card"],[1,"profile-images"],[1,"profile-image"],[3,"src"],["class","profile-image",4,"ngIf"],[1,"profile-info"],[1,"mt-1"],[4,"ngIf"],["style","background-color: white; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); padding: 20px; margin: 20px;",4,"ngIf"],["style","width: 100%; display: flex; justify-content: center; margin-top: 30px;",4,"ngIf"],["style","width: 1200px;",4,"ngIf"],[2,"background-color","white","border-radius","8px","box-shadow","0 4px 8px rgba(0, 0, 0, 0.1)","padding","20px","margin","20px"],[1,"buttons-container"],[3,"click",4,"ngFor","ngForOf"],[2,"margin-top","20px","padding","10px","background-color","#007bff","color","white","border","none","border-radius","5px",3,"click"],[4,"ngFor","ngForOf"],[3,"click"],[2,"width","100%","display","flex","justify-content","center","margin-top","30px"],[2,"width","1200px"]],template:function(i,n){i&1&&(D(0,"app-header",0),l(1,"button",1),w("click",function(){return n.cambiarTema()}),c(2,` Cambiar Tema
`),a(),v(3,he,28,14,"div",2)),i&2&&(p("title","MyClinic"),s(3),p("ngIf",n.userData))},dependencies:[ee,Z,K,te,ie],styles:['@charset "UTF-8";.profile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:20px;background-color:#4c7bb8;min-height:1000px}.profile-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;background-color:#fff;padding:20px;border-radius:8px;box-shadow:0 4px 8px #0000001a;width:960px;margin-bottom:20px}.profile-images[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px;margin-bottom:15px}.profile-image[_ngcontent-%COMP%]{flex-shrink:0}.profile-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:200px;height:200px;border-radius:50%;border:3px solid #ddd;object-fit:cover}.profile-info[_ngcontent-%COMP%]{font-size:16px;line-height:1.6}.profile-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;margin-bottom:10px;font-weight:600;color:#333}.profile-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.profile-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#555}.profile-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-child{margin-bottom:0}h2[_ngcontent-%COMP%]{font-size:22px;margin-top:20px;font-weight:600;color:#333;border-bottom:2px solid #28a745;padding-bottom:5px;margin-bottom:20px}.profile-section[_ngcontent-%COMP%]   .profile-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .profile-section[_ngcontent-%COMP%]   .profile-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:5px 0}.profile-section[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;color:#333;margin-top:15px;font-weight:700}.profile-section[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:400;font-size:16px}.profile-section[_ngcontent-%COMP%]   .profile-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#555}.buttons-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;align-items:center}button[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;font-size:16px;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;transition:background-color .3s ease;margin-top:20px}button[_ngcontent-%COMP%]:hover{background-color:#45a049}button[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 5px 2px #48914299}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.btn-flotante[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;padding:10px 20px;background-color:#007bff;color:#fff;border:none;border-radius:50%;font-size:16px;cursor:pointer;box-shadow:0 4px 6px #0000001a}.btn-flotante[_ngcontent-%COMP%]:hover{background-color:#0056b3}']});let o=r;return o})();export{we as PerfilesComponent};
